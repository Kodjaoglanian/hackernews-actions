name: Hacker News to Discord

on:
  schedule:
    - cron: "0 9 * * *"  # Todo dia Ã s 09:00 UTC
  workflow_dispatch:

jobs:
  send-news:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install requests

      - name: Send Hacker News top stories to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          python << 'EOF'
          import os
          import requests

          webhook_url = os.getenv("DISCORD_WEBHOOK_URL")
          if not webhook_url:
              raise Exception("âŒ DISCORD_WEBHOOK_URL nÃ£o definido.")

          # Pega os top 5 IDs das histÃ³rias do Hacker News
          top_stories_ids = requests.get("https://hacker-news.firebaseio.com/v0/topstories.json").json()[:5]
          messages = []

          for story_id in top_stories_ids:
              story = requests.get(f"https://hacker-news.firebaseio.com/v0/item/{story_id}.json").json()
              title = story.get("title", "Sem tÃ­tulo")
              url = story.get("url", f"https://news.ycombinator.com/item?id={story_id}")
              messages.append(f"**{title}**\n{url}\n")

          payload = {
              "content": "ðŸ“° **Top Hacker News do dia:**\n\n" + "\n".join(messages)
          }

          response = requests.post(webhook_url, json=payload)
          response.raise_for_status()
          print("âœ… NotÃ­cias enviadas com sucesso!")
          EOF
