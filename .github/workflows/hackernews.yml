name: Hacker News to Discord

on:
  schedule:
    - cron: "0 9 * * *" # 09:00 UTC todo dia (ajuste se quiser outro hor√°rio)
  workflow_dispatch:

jobs:
  send-news:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: pip install requests

      - name: Send Hacker News to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          python << 'EOF'
          import requests

          # Busca top stories
          top_stories = requests.get("https://hacker-news.firebaseio.com/v0/topstories.json").json()[:5]
          mensagens = []

          for story_id in top_stories:
              story = requests.get(f"https://hacker-news.firebaseio.com/v0/item/{story_id}.json").json()
              mensagens.append(f"**{story.get('title')}**\n{story.get('url', 'Sem link')}\n")

          payload = {
              "content": "üì∞ **Top Hacker News do dia:**\n\n" + "\n".join(mensagens)
          }

          resp = requests.post(
              url="${{ secrets.DISCORD_WEBHOOK_URL }}",
              json=payload
          )

          resp.raise_for_status()
          print("‚úÖ Not√≠cias enviadas com sucesso!")
          EOF
